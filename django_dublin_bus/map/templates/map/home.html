<!DOCTYPE html>
<html lang="en">
<head>
    <title>Dublin Bus - Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta charset="utf-8">

    {#        Live Geolocation API Connection#}
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.19.0.min.js"></script>

    <!--Jquery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    {% load staticfiles %}
    <link rel="stylesheet" type="text/css" href="{% static 'map/css/home.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'map/css/mobile_bottom_nav_bar.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'map/css/map.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'map/css/info_section.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'map/css/route_options.css' %}">
    <link rel="shortcut icon" type="image/png" href="{% static 'map/images/favicon.ico' %}">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Compressed CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/foundation-sites@6.5.3/dist/css/foundation.min.css" integrity="sha256-xpOKVlYXzQ3P03j397+jWFZLMBXLES3IiryeClgU5og= sha384-gP4DhqyoT9b1vaikoHi9XQ8If7UNLO73JFOOlQV1RATrA7D0O7TjJZifac6NwPps sha512-AKwIib1E+xDeXe0tCgbc9uSvPwVYl6Awj7xl0FoaPFostZHOuDQ1abnDNCYtxL/HWEnVOMrFyf91TDgLPi9pNg==" crossorigin="anonymous">
    <!-- Compressed JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/foundation-sites@6.5.3/dist/js/foundation.min.js" integrity="sha256-/PFxCnsMh+nTuM0k3VJCRch1gwnCfKjaP8rJNq5SoBg= sha384-9ksAFjQjZnpqt6VtpjMjlp2S0qrGbcwF/rvrLUg2vciMhwc1UJJeAAOLuJ96w+Nj sha512-UMSn6RHqqJeJcIfV1eS2tPKCjzaHkU/KqgAnQ7Nzn0mLicFxaVhm9vq7zG5+0LALt15j1ljlg8Fp9PT1VGNmDw==" crossorigin="anonymous"></script>
</head>

<body>
    <div class="grid-y grid-frame">
        <div id="map_container" class="cell">
            <div id="map"></div>
        </div>

        <div class="cell" id="info_section">
        </div>

        <div class="mobile-app-icon-bar">
        {% load staticfiles %}
            <a id='directions_view' class="footer-link" onclick="populate_info('directions_view')"><img class="fa" aria-hidden="true" src="{% static "map/images/directions.png" %}"></a>
            <a id="favourites_view" class="footer-link" onclick="populate_info('favourites_view')"><img class="fa" aria-hidden="true" src="{% static "map/images/favourites.png" %}"></a>
            <a id='journey_view' class="footer-link" onclick="populate_info('journey_view')"><img class="fa" aria-hidden="true" src="{% static "map/images/journey.png" %}"></a>
        </div>
    </div>

    <script>
        <!--Global Variables-->
        var model_url = '{% url "run_model" %}';
        var get_sun_url = '{% url "get_sun" %}';
        var geo_for_emptystring = [];
        var x;
        var user_marker_image = ""; // Not doing anything yet but to be used for customer user location marker
        var bus_marker_image = ""; // Not doing anything yet but to be used for busstop location marker

        var map; // for initialising the maps map object
        var geocoder; // for initialising the maps geocoder object
        var user_location_marker;
        var markers = []; // storing the markers as we create them
        var autocomplete_options;
        var origin_searchbox;
        var destination_searchbox;
        var directionsRenderer;

        var rendered_route_list = [];

        var sunrise;
        var sunset;
        
    </script>

    {% load staticfiles %}
    <script type="text/javascript" src="{% static 'map/js/journey_date_selector.js' %}"></script>
    <script type="text/javascript" src="{% static 'map/js/geolocation.js' %}"></script>
    <script type="text/javascript" src="{% static 'map/js/cache_user_favourites.js' %}"></script>
    <script type="text/javascript" src="{% static 'map/js/map_initialiser.js' %}"></script>
    <script type="text/javascript" src="{% static 'map/js/set_map_night_mode.js' %}"></script>

    <script>
        function loopBusStops(){
            console.log("Calling loopBusStops function!");
            {%  for bus_stop in bus_stops %}
                
                var latLng = {lat:{{ bus_stop.stop_lat}}, lng:{{bus_stop.stop_lng }}};
                var marker = new google.maps.Marker({
                    position: latLng,
                    map: map,
                });

                var infoWindow = new google.maps.InfoWindow();
                google.maps.event.addListener(marker, 'click', function () {
                    var stop_id = '{{bus_stop.stop_id}}';
                    var stop_name = '{{ bus_stop.stop_name }}'
                    AjaxGetRoutes(stop_id, infoWindow, stop_name);
                    infoWindow.open(this.getMap(), this);
                });
                markers.push(marker);

            {%  endfor %}
        }
    </script>

    <script type="text/javascript" src="{% static 'map/js/generateRoute.js' %}"></script>
    <script type="text/javascript" src="{% static 'map/js/map_routing.js' %}"></script>
    <script type="text/javascript" src="{% static 'map/js/populate_info_section.js' %}"></script>
    <script type="text/javascript" src="{% static 'map/js/ajax_model.js' %}"></script>
    <script type="text/javascript" src="{% static 'map/js/ajax_get_routes.js' %}"></script>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_key }}&callback=initialize&libraries=places"></script>
    <script>
        populate_info("directions_view");
    </script>
</body>
</html>